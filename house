# Define the target directory
$targetDirectory = "C:\Path\To\Your\Folder"

# Define the date threshold (files older than this date will be deleted)
$dateThreshold = (Get-Date).AddMonths(-3)

# Get the directory information using .NET
$directoryInfo = New-Object System.IO.DirectoryInfo $targetDirectory

# Initialize a counter for deleted files
$deletedFileCount = 0

# Function to delete files older than the threshold date
function Delete-OldFiles($directoryInfo) {
    global $deletedFileCount

    # Get all files in the directory
    $files = $directoryInfo.GetFiles()

    # Filter and delete files older than the threshold date
    foreach ($file in $files) {
        if ($file.CreationTime -lt $dateThreshold) {
            try {
                $file.Delete()
                $deletedFileCount++
            } catch {
                Write-Error "Failed to delete file: $($file.FullName). Error: $_"
            }
        }
    }

    # Optional: To include subdirectories
    $subdirectories = $directoryInfo.GetDirectories("*", [System.IO.SearchOption]::TopDirectoryOnly)
    foreach ($subdirectory in $subdirectories) {
        Delete-OldFiles $subdirectory
    }
}

# Call the function to delete old files
Delete-OldFiles $directoryInfo

# Output the count of deleted files
Write-Output "Total deleted files: $deletedFileCount"
